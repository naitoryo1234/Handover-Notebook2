# LINE Messaging API é€£æºè¨­è¨ˆæ›¸

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: Business Notebook  
**æœ€çµ‚æ›´æ–°**: 2025-12-20  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨­è¨ˆæ¡ˆï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡ï¼‰

---

## 1. æ¦‚è¦

### 1.1 ç›®çš„

Business Notebook ã« LINE Messaging API ã‚’é€£æºã•ã›ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ï¼š

1. **ãƒªãƒã‚¤ãƒ³ãƒ‰é€šçŸ¥**: äºˆç´„å‰æ—¥ãƒ»å½“æ—¥ã«LINEã§ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’è‡ªå‹•é€ä¿¡
2. **å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¨˜éŒ²**: é¡§å®¢ã‹ã‚‰ã®LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚·ã‚¹ãƒ†ãƒ ã«å–ã‚Šè¾¼ã¿ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«ä¿å­˜
3. **IDé€£æº**: ã‚·ã‚¹ãƒ†ãƒ å†…ã®é¡§å®¢ï¼ˆPatientï¼‰ã¨LINE User IDã‚’å®‰å…¨ã«ç´ä»˜ã‘

### 1.2 æƒ³å®šãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

| ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | èª¬æ˜ | æ–™é‡‘ |
|:---|:---|:---|
| **äºˆç´„ãƒªãƒã‚¤ãƒ³ãƒ‰** | äºˆç´„ã®å‰æ—¥ 18:00 ã«ã€Œæ˜æ—¥ 10:00 ã«äºˆç´„ãŒå…¥ã£ã¦ã„ã¾ã™ã€ã¨é€ä¿¡ | Pushï¼ˆæœˆ500é€šï¼‰ |
| **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡** | é¡§å®¢ãŒã€Œæ¬¡å›ã¯æ¥é€±ã§ãŠé¡˜ã„ã—ã¾ã™ã€ã¨é€ä¿¡ â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«è¨˜éŒ² | ç„¡æ–™ |
| **è‡ªå‹•è¿”ä¿¡** | é¡§å®¢ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã«å¿œã˜ã¦ã‚·ã‚¹ãƒ†ãƒ ãŒè‡ªå‹•ã§è¿”ä¿¡ | Replyï¼ˆç„¡æ–™ãƒ»ç„¡åˆ¶é™ï¼‰ |
| **æ‰‹å‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** | ã‚¹ã‚¿ãƒƒãƒ•ãŒé¡§å®¢è©³ç´°ç”»é¢ã‹ã‚‰ç›´æ¥LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ | Pushï¼ˆæœˆ500é€šï¼‰ |

---

## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 å…¨ä½“æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LINE Platform                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ LINE App    â”‚              â”‚ Messaging API    â”‚              â”‚
â”‚  â”‚ (é¡§å®¢)      â”‚              â”‚                  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                              â”‚                         â”‚
â”‚         â”‚ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡               â”‚ Webhook (å—ä¿¡)          â”‚
â”‚         â”‚                              â”‚ Push API (é€ä¿¡)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                              â”‚
          â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Vercel (Serverless)                         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                Next.js App Router                         â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚  â”‚ /api/line/      â”‚    â”‚ /api/line/      â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ webhook         â”‚    â”‚ send            â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ (å—ä¿¡)          â”‚    â”‚ (é€ä¿¡)          â”‚             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚           â”‚                       â”‚                      â”‚   â”‚
â”‚  â”‚           â–¼                       â–¼                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚           LINE Service Layer                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - ç½²åæ¤œè¨¼                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è§£æ                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - é€ä¿¡å‡¦ç†                                      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Prisma ORM                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Neon PostgreSQL                               â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Patient      â”‚  â”‚ LineMessage  â”‚  â”‚ LineLinkRequest    â”‚     â”‚
â”‚  â”‚ (æ—¢å­˜)       â”‚  â”‚ (æ–°è¦)       â”‚  â”‚ (æ–°è¦)             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆé‹ç”¨ãƒ¢ãƒ‡ãƒ«

å„åº—èˆ—ï¼ˆãƒ†ãƒŠãƒ³ãƒˆï¼‰ãŒè‡ªåˆ†ã®LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®APIèªè¨¼æƒ…å ±ã‚’ã‚·ã‚¹ãƒ†ãƒ ã«å…¥åŠ›ã—ã¦é€£æºã™ã‚‹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Business Notebook (SaaS)                     â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ åº—èˆ—A          â”‚  â”‚ åº—èˆ—B          â”‚  â”‚ åº—èˆ—C          â”‚    â”‚
â”‚  â”‚ LINE Secret A â”‚  â”‚ LINE Secret B â”‚  â”‚ LINE Secret C â”‚    â”‚
â”‚  â”‚ LINE Token A  â”‚  â”‚ LINE Token B  â”‚  â”‚ LINE Token C  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å°å…¥ãƒ•ãƒ­ãƒ¼:**
1. åº—èˆ—ãŒBusiness Notebookã‚’å°å…¥
2. åº—èˆ—ãŒè‡ªåˆ†ã®LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§Messaging APIã‚’æœ‰åŠ¹åŒ–
3. Channel Secret / Access Token ã‚’å–å¾—
4. Business Notebookã®ã€ŒLINEé€£æºè¨­å®šã€ç”»é¢ã«å…¥åŠ›
5. é€£æºå®Œäº†

### 2.3 Vercelç’°å¢ƒã¸ã®é©åˆ

| é …ç›® | å¯¾å¿œæ–¹é‡ |
|:---|:---|
| **Serverlessåˆ¶ç´„** | Webhookã¯10ç§’ä»¥å†…ã«200å¿œç­”ã‚’è¿”ã™ã€‚é‡ã„å‡¦ç†ã¯éåŒæœŸï¼ˆVercel Cron/Queueï¼‰ã«å§”è­² |
| **ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ** | Edge Functionã¯ä½¿ç”¨ã›ãšã€Node.js Runtimeã§çµ±ä¸€ï¼ˆPrismaã¨ã®äº’æ›æ€§ï¼‰ |
| **èªè¨¼æƒ…å ±** | ç’°å¢ƒå¤‰æ•°ã§ã¯ãªãDBã«å„ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ä¿å­˜ |

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### 3.1 æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤‰æ›´

#### Patient ãƒ†ãƒ¼ãƒ–ãƒ«

æ—¢å­˜ã® `externalRef` (JSON) ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ´»ç”¨ã—ã€LINE User ID ã‚’æ ¼ç´ã™ã‚‹ã€‚

```prisma
model Patient {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...
  externalRef  String  @default("{}")  // â† ã“ã“ã«LINEæƒ…å ±ã‚’æ ¼ç´
}
```

**externalRef ã®æ§‹é€ :**

```json
{
  "line": {
    "userId": "U1234567890abcdef...",
    "displayName": "å±±ç”°å¤ªéƒ",
    "linkedAt": "2025-12-20T10:00:00.000Z"
  }
}
```

> [!NOTE]
> åˆ¥ã‚«ãƒ©ãƒ è¿½åŠ ã§ã¯ãªã JSON ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½¿ã†ç†ç”±:
> - å°†æ¥çš„ã«ä»–ã®å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒ¡ãƒ¼ãƒ«ã€SMSç­‰ï¼‰ã‚‚åŒæ§˜ã«æ ¼ç´å¯èƒ½
> - ã‚¹ã‚­ãƒ¼ãƒãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ã§æ‹¡å¼µå¯èƒ½

### 3.2 æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«

#### LineChannel ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œï¼‰

å„åº—èˆ—ã®LINE APIèªè¨¼æƒ…å ±ã‚’ä¿å­˜ã€‚

```prisma
model LineChannel {
  id                 String   @id @default(uuid())
  name               String   // è¡¨ç¤ºåï¼ˆä¾‹: ã€Œâ—‹â—‹é™¢ äºˆç´„é€šçŸ¥ã€ï¼‰
  channelId          String   @unique  // LINE Channel ID
  channelSecret      String   // ç½²åæ¤œè¨¼ç”¨ï¼ˆæš—å·åŒ–æ¨å¥¨ï¼‰
  channelAccessToken String   // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ç”¨ï¼ˆæš—å·åŒ–æ¨å¥¨ï¼‰
  webhookUrl         String?  // ç”Ÿæˆã•ã‚ŒãŸWebhook URL
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  messages           LineMessage[]
}
```

> [!IMPORTANT]
> `channelSecret` ã¨ `channelAccessToken` ã¯æ©Ÿå¯†æƒ…å ±ã€‚
> å°†æ¥çš„ã«ã¯AESæš—å·åŒ–ã‚’æ¤œè¨ã€‚åˆæœŸå®Ÿè£…ã§ã¯å¹³æ–‡ä¿å­˜ã€‚

#### LineMessage ãƒ†ãƒ¼ãƒ–ãƒ«

LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€å—ä¿¡å±¥æ­´ã‚’ä¿å­˜ã€‚

```prisma
model LineMessage {
  id          String       @id @default(uuid())
  channelId   String       // ã©ã®ãƒãƒ£ãƒ³ãƒãƒ«çµŒç”±ã‹
  patientId   String?
  lineUserId  String
  direction   String       // "incoming" | "outgoing"
  messageType String       // "text" | "image" | "sticker" | etc.
  content     String       // ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹ã¾ãŸã¯å‚ç…§æƒ…å ±
  rawPayload  String       @default("{}")  // LINE APIã®ç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹
  status      String       @default("sent") // "sent" | "delivered" | "read" | "failed"
  sentAt      DateTime     @default(now())
  createdAt   DateTime     @default(now())
  
  channel     LineChannel  @relation(fields: [channelId], references: [id])
  patient     Patient?     @relation(fields: [patientId], references: [id])
  
  @@index([channelId, sentAt])
  @@index([patientId, sentAt])
  @@index([lineUserId])
}
```

#### LineLinkRequest ãƒ†ãƒ¼ãƒ–ãƒ«

IDé€£æºã®ãŸã‚ã®ä¸€æ™‚ãƒªãƒ³ã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã€‚

```prisma
model LineLinkRequest {
  id        String   @id @default(uuid())
  patientId String   @unique
  token     String   @unique  // ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ãƒˆãƒ¼ã‚¯ãƒ³
  expiresAt DateTime           // æœ‰åŠ¹æœŸé™ï¼ˆ24æ™‚é–“ãªã©ï¼‰
  createdAt DateTime @default(now())
  
  patient   Patient  @relation(fields: [patientId], references: [id])
}
```

---

## 4. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­è¨ˆ

### 4.1 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ line/
â”‚   â”‚       â”œâ”€â”€ webhook/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts       # Webhookå—ä¿¡ï¼ˆPOSTï¼‰
â”‚   â”‚       â”œâ”€â”€ send/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts       # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆPOSTï¼‰
â”‚   â”‚       â””â”€â”€ link/
â”‚   â”‚           â”œâ”€â”€ [token]/
â”‚   â”‚           â”‚   â””â”€â”€ route.ts   # é€£æºå®Œäº†å‡¦ç†ï¼ˆGETï¼‰
â”‚   â”‚           â””â”€â”€ route.ts       # é€£æºURLç™ºè¡Œï¼ˆPOSTï¼‰
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â””â”€â”€ line/
â”‚   â”‚       â””â”€â”€ page.tsx           # LINEé€£æºè¨­å®šç”»é¢
â”‚   â””â”€â”€ line/
â”‚       â””â”€â”€ link/
â”‚           â””â”€â”€ [token]/
â”‚               â””â”€â”€ page.tsx       # LIFFé€£æºãƒšãƒ¼ã‚¸
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ lineService.ts             # LINE API ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â””â”€â”€ lineAutoReplyService.ts    # è‡ªå‹•è¿”ä¿¡ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ line.ts                    # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–ãƒ»ç½²åæ¤œè¨¼
â”œâ”€â”€ actions/
â”‚   â””â”€â”€ lineActions.ts             # Server Actionsï¼ˆUIé€£æºç”¨ï¼‰
â””â”€â”€ components/
    â””â”€â”€ settings/
        â””â”€â”€ LineSettingsForm.tsx   # APIèªè¨¼æƒ…å ±å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
```

### 4.2 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´°

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|:---|:---|:---|
| `/api/line/webhook` | POST | LINE Platformã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ |
| `/api/line/send` | POST | ãƒ—ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆå†…éƒ¨ç”¨ï¼‰ |
| `/api/line/link` | POST | é€£æºURLç™ºè¡Œ |
| `/api/line/link/[token]` | GET | é€£æºå®Œäº†ï¼ˆLIFFã‹ã‚‰å‘¼ã³å‡ºã—ï¼‰ |

---

## 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 5.1 Webhookç½²åæ¤œè¨¼ï¼ˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œï¼‰

LINE Platformã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€`x-line-signature` ãƒ˜ãƒƒãƒ€ãƒ¼ã§æ¤œè¨¼ã™ã‚‹ã€‚
å„ãƒ†ãƒŠãƒ³ãƒˆã® `channelSecret` ã¯DBã‹ã‚‰å–å¾—ã€‚

```typescript
// lib/line.ts
import crypto from 'crypto';
import { prisma } from '@/lib/prisma';

export async function verifySignature(
  body: string, 
  signature: string,
  channelId: string
): Promise<boolean> {
  // DBã‹ã‚‰ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’å–å¾—
  const channel = await prisma.lineChannel.findUnique({
    where: { channelId }
  });
  
  if (!channel) return false;
  
  const hash = crypto
    .createHmac('sha256', channel.channelSecret)
    .update(body)
    .digest('base64');
  return hash === signature;
}
```

### 5.2 èªè¨¼æƒ…å ±ã®ä¿å­˜

| é …ç›® | ä¿å­˜å…ˆ | èª¬æ˜ |
|:---|:---|:---|
| **Channel ID** | DB (LineChannel) | å„ãƒ†ãƒŠãƒ³ãƒˆã®ãƒãƒ£ãƒ³ãƒãƒ«ID |
| **Channel Secret** | DB (LineChannel) | Webhookç½²åæ¤œè¨¼ç”¨ |
| **Channel Access Token** | DB (LineChannel) | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ç”¨ |
| **LIFF ID** | ç’°å¢ƒå¤‰æ•° | å…¨ãƒ†ãƒŠãƒ³ãƒˆå…±é€šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰|

> [!CAUTION]
> ã“ã‚Œã‚‰ã®å€¤ã¯ `.env.local` ã«ã‚³ãƒ”ãƒ¼ã—ãªã„ã“ã¨ã€‚Vercel Dashboard ã®ã¿ã§ç®¡ç†ã™ã‚‹ã€‚

### 5.3 ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

- **Webhook**: ç½²åæ¤œè¨¼ã®ã¿ï¼ˆIPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã¯ä¸è¦ï¼‰
- **Send API**: èªè¨¼æ¸ˆã¿ã‚¹ã‚¿ãƒƒãƒ•ã®ã¿ï¼ˆNextAuth.js ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèªï¼‰
- **Link API**: ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ + LIFFå†…ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿è¨±å¯

---

## 6. IDé€£æºãƒ•ãƒ­ãƒ¼

### 6.1 ãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¹ã‚¿ãƒƒãƒ•      â”‚  â”‚ Business Notebook        â”‚  â”‚ LINE Platform  â”‚
â”‚ (PC/ã‚¹ãƒãƒ›)   â”‚  â”‚ (Vercel)                 â”‚  â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚                        â”‚
       â”‚ 1. é¡§å®¢è©³ç´°ç”»é¢ã§       â”‚                        â”‚
       â”‚   ã€ŒLINEé€£æºã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹ â”‚                        â”‚
       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
       â”‚                       â”‚                        â”‚
       â”‚                       â”‚ 2. LineLinkRequestä½œæˆ  â”‚
       â”‚                       â”‚   (tokenç”Ÿæˆã€24hæœ‰åŠ¹)   â”‚
       â”‚                       â”‚                        â”‚
       â”‚ 3. é€£æºç”¨QRã‚³ãƒ¼ãƒ‰/URL   â”‚                        â”‚
       â”‚   ã‚’è¡¨ç¤º               â”‚                        â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                        â”‚
       â”‚                       â”‚                        â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚       é¡§å®¢ãŒã‚¹ãƒãƒ›ã§QRã‚’èª­ã¿å–ã‚Š                   â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                       â”‚                        â”‚
       â”‚                       â”‚ 4. LIFFèµ·å‹•             â”‚
       â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                       â”‚                        â”‚
       â”‚                       â”‚ 5. LINE User IDå–å¾—     â”‚
       â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                       â”‚                        â”‚
       â”‚                       â”‚ 6. Tokenæ¤œè¨¼ & ç´ä»˜ã‘ä¿å­˜â”‚
       â”‚                       â”‚   Patient.externalRef   â”‚
       â”‚                       â”‚   ã« LINE userId æ ¼ç´   â”‚
       â”‚                       â”‚                        â”‚
       â”‚                       â”‚ 7. é€£æºå®Œäº†é€šçŸ¥          â”‚
       â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                       â”‚   ã€Œé€£æºãŒå®Œäº†ã—ã¾ã—ãŸã€   â”‚
       â”‚                       â”‚                        â”‚
       â”‚ 8. é¡§å®¢è©³ç´°ç”»é¢ã«       â”‚                        â”‚
       â”‚   ã€ŒLINEé€£æºæ¸ˆã¿ã€è¡¨ç¤º  â”‚                        â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                        â”‚
       â”‚                       â”‚                        â”‚
```

### 6.2 é€£æºç”¨LIFFã‚¢ãƒ—ãƒª

**ç›®çš„**: é¡§å®¢ãŒLINEã‚¢ãƒ—ãƒªå†…ã§IDé€£æºã‚’å®Œäº†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

**æ§‹æˆ**:
- LIFFãƒšãƒ¼ã‚¸ï¼ˆ`/line/link/[token]`ï¼‰ã‚’ç”¨æ„
- `liff.getProfile()` ã§ LINE User ID ã‚’å–å¾—
- ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã¦ Patient ã¨ç´ä»˜ã‘

---

## 7. è‡ªå‹•è¿”ä¿¡æ©Ÿèƒ½

### 7.1 æ¦‚è¦

é¡§å®¢ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¯¾ã—ã¦ã€**Reply APIï¼ˆç„¡æ–™ãƒ»ç„¡åˆ¶é™ï¼‰** ã‚’ä½¿ç”¨ã—ã¦è‡ªå‹•è¿”ä¿¡ã‚’è¡Œã†ã€‚

> [!IMPORTANT]
> Reply API ã¯ Webhook å—ä¿¡ã‹ã‚‰ **30ç§’ä»¥å†…** ã«è¿”ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
> é‡ã„å‡¦ç†ï¼ˆAIè§£æç­‰ï¼‰ã¯å¾Œå›ã—ã«ã—ã€ã¾ãšå®šå‹æ–‡ã§å³åº§ã«è¿”ä¿¡ã™ã‚‹ã€‚

### 7.2 ãƒ•ãƒ­ãƒ¼

```
é¡§å®¢ãŒLINEã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    â†“
Webhook ã§å—ä¿¡ï¼ˆreplyToken ä»˜ãï¼‰
    â†“
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’è§£æï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒï¼‰
    â†“
30ç§’ä»¥å†…ã« replyToken ã‚’ä½¿ã£ã¦è¿”ä¿¡ â† ç„¡æ–™
    â†“
åŒæ™‚ã« LineMessage ãƒ†ãƒ¼ãƒ–ãƒ«ã«é€å—ä¿¡ã‚’ä¿å­˜
```

### 7.3 ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒä¾‹

| é¡§å®¢ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | è‡ªå‹•è¿”ä¿¡ |
|:---|:---|
| ã€Œäºˆç´„ã€ã€Œäºˆç´„ã—ãŸã„ã€ | ğŸ“… äºˆç´„ã¯ã“ã¡ã‚‰ã‹ã‚‰ãŠé¡˜ã„ã—ã¾ã™: [äºˆç´„ãƒšãƒ¼ã‚¸URL] |
| ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ | âš ï¸ ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã®ã”é€£çµ¡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã‚¹ã‚¿ãƒƒãƒ•ã‚ˆã‚ŠæŠ˜ã‚Šè¿”ã—ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚ |
| ã€Œå–¶æ¥­æ™‚é–“ã€ã€Œä½•æ™‚ã¾ã§ã€ | ğŸ• å–¶æ¥­æ™‚é–“: 10:00ã€œ20:00ï¼ˆæ—¥æ›œå®šä¼‘ï¼‰ |
| ã€Œæ¬¡ã®äºˆç´„ã€ã€Œã„ã¤ã§ã—ãŸã£ã‘ã€ | â†’ é¡§å®¢ã®æ¬¡å›äºˆç´„ã‚’æ¤œç´¢ã—ã¦è¿”ä¿¡ï¼ˆå‹•çš„ï¼‰ |
| ãã®ä»– | ğŸ“© ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚ã‚¹ã‚¿ãƒƒãƒ•ã‚ˆã‚ŠæŠ˜ã‚Šè¿”ã—ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚ |

### 7.4 è‡ªå‹•è¿”ä¿¡è¨­å®šã®ç®¡ç†

å°†æ¥çš„ã«ã¯ã€ç®¡ç†ç”»é¢ã‹ã‚‰è‡ªå‹•è¿”ä¿¡ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

```prisma
model LineAutoReply {
  id          String   @id @default(uuid())
  keyword     String   // ãƒãƒƒãƒã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰
  response    String   // è¿”ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  priority    Int      @default(0)  // å„ªå…ˆåº¦ï¼ˆé«˜ã„é †ã«ãƒãƒƒãƒï¼‰
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

> [!NOTE]
> åˆæœŸå®Ÿè£…ã§ã¯ã‚³ãƒ¼ãƒ‰å†…ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ã€ç®¡ç†ç”»é¢ã¯å°†æ¥ãƒ•ã‚§ãƒ¼ã‚ºã§è¿½åŠ ã€‚

---

## 8. ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### 7.1 æ¨å¥¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ç”¨é€” | ç†ç”± |
|:---|:---|:---|
| `@line/bot-sdk` | LINE Messaging APIå…¬å¼SDK | å‹å®šç¾©ãŒå……å®Ÿã€ç½²åæ¤œè¨¼å†…è”µ |
| `@line/liff` | LIFF SDK | IDé€£æºç”¨ãƒšãƒ¼ã‚¸ã§ä½¿ç”¨ |

### 7.2 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰

```bash
npm install @line/bot-sdk @line/liff
```

---

## 9. é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆ1-2æ—¥ï¼‰

- [ ] LINE Developers ã§ Messaging API ãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆ
- [ ] ç’°å¢ƒå¤‰æ•°ã®è¨­å®šï¼ˆVercel Dashboardï¼‰
- [ ] `lib/line.ts` - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–ãƒ»ç½²åæ¤œè¨¼
- [ ] `services/lineService.ts` - åŸºæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹
- [ ] Prismaã‚¹ã‚­ãƒ¼ãƒæ›´æ–°ï¼ˆLineMessage, LineLinkRequestï¼‰

### Phase 2: Webhookå—ä¿¡ & ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¿å­˜ï¼ˆ1æ—¥ï¼‰

- [ ] `/api/line/webhook/route.ts` å®Ÿè£…
- [ ] ç½²åæ¤œè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
- [ ] LineMessageãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®ä¿å­˜
- [ ] Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ & LINE Developersã§Webhook URLè¨­å®š

### Phase 2.5: è‡ªå‹•è¿”ä¿¡æ©Ÿèƒ½ï¼ˆ0.5æ—¥ï¼‰

- [ ] `services/lineAutoReplyService.ts` - è‡ªå‹•è¿”ä¿¡ãƒ­ã‚¸ãƒƒã‚¯
- [ ] ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°å®Ÿè£…
- [ ] Reply API ã§ã®è¿”ä¿¡å‡¦ç†
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### Phase 3: IDé€£æºå®Ÿè£…ï¼ˆ1-2æ—¥ï¼‰

- [ ] `/api/line/link/route.ts` - é€£æºURLç™ºè¡Œ
- [ ] LIFFè¨­å®šï¼ˆLINE Developersï¼‰
- [ ] `/app/line/link/[token]/page.tsx` - LIFFé€£æºãƒšãƒ¼ã‚¸
- [ ] é€£æºå®Œäº†å‡¦ç† & Patient.externalRefæ›´æ–°
- [ ] é¡§å®¢è©³ç´°ç”»é¢ã«LINEé€£æºãƒœã‚¿ãƒ³è¿½åŠ 

### Phase 4: æ‰‹å‹•é€ä¿¡æ©Ÿèƒ½ï¼ˆ1æ—¥ï¼‰

- [ ] `/api/line/send/route.ts` å®Ÿè£…
- [ ] `lineActions.ts` - Server Actionsï¼ˆUIç”¨ï¼‰
- [ ] é¡§å®¢è©³ç´°ç”»é¢ã‹ã‚‰ã®æ‰‹å‹•é€ä¿¡UI

### Phase 5: äºˆç´„ãƒªãƒã‚¤ãƒ³ãƒ‰è‡ªå‹•é€ä¿¡ï¼ˆ1-2æ—¥ï¼‰

- [ ] Vercel Cron Jobs è¨­å®šï¼ˆæ¯æ—¥18:00å®Ÿè¡Œï¼‰
- [ ] äºˆç´„ãƒªãƒã‚¤ãƒ³ãƒ‰é€ä¿¡ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç¿Œæ—¥äºˆç´„ã®ã¿ï¼‰
- [ ] é€ä¿¡ãƒ­ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

## 10. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆæœ€çµ‚å½¢ï¼‰

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ line/
â”‚   â”‚       â”œâ”€â”€ webhook/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚       â”œâ”€â”€ send/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚       â””â”€â”€ link/
â”‚   â”‚           â”œâ”€â”€ [token]/
â”‚   â”‚           â”‚   â””â”€â”€ route.ts
â”‚   â”‚           â””â”€â”€ route.ts
â”‚   â””â”€â”€ line/
â”‚       â””â”€â”€ link/
â”‚           â””â”€â”€ [token]/
â”‚               â””â”€â”€ page.tsx        # LIFFé€£æºãƒšãƒ¼ã‚¸
â”œâ”€â”€ services/
â”‚   â””â”€â”€ lineService.ts
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ line.ts
â”œâ”€â”€ actions/
â”‚   â””â”€â”€ lineActions.ts
â””â”€â”€ components/
    â””â”€â”€ line/
        â”œâ”€â”€ LineLinkButton.tsx      # é€£æºãƒœã‚¿ãƒ³
        â”œâ”€â”€ LineMessageForm.tsx     # é€ä¿¡ãƒ•ã‚©ãƒ¼ãƒ 
        â””â”€â”€ LineStatusBadge.tsx     # é€£æºçŠ¶æ…‹è¡¨ç¤º
```

---

## 11. è€ƒæ…®äº‹é …ãƒ»åˆ¶é™

### 10.1 LINE Messaging API ã®åˆ¶é™

| é …ç›® | åˆ¶é™ |
|:---|:---|
| **Push ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** | ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ã¯æœˆ500é€šã¾ã§ï¼ˆæœ‰æ–™ãƒ—ãƒ©ãƒ³ã§ç„¡åˆ¶é™ï¼‰ |
| **Reply ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** | ç„¡æ–™ãƒ»ç„¡åˆ¶é™ï¼ˆWebhookã¸ã®å¿œç­”ã¨ã—ã¦ï¼‰ |
| **ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼** | è¨­å®šå¯èƒ½ï¼ˆå°†æ¥æ‹¡å¼µã¨ã—ã¦æ¤œè¨ï¼‰ |

### 10.2 LIFF ã®åˆ¶é™

- **HTTPSå¿…é ˆ**: Vercelãªã‚‰è‡ªå‹•å¯¾å¿œ
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ç™»éŒ²å¿…è¦**: LINE Developersã§è¨­å®š

### 10.3 ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é…æ…®

- é¡§å®¢ã¸ã®æ˜ç¤ºçš„ãªåŒæ„å–å¾—ãŒå¿…è¦
- LINE User IDã¯å€‹äººæƒ…å ±ã¨ã—ã¦é©åˆ‡ã«ç®¡ç†

---

## 12. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ã“ã®è¨­è¨ˆæ¡ˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ‰¿èª**
2. **LINE Developersã‚¢ã‚«ã‚¦ãƒ³ãƒˆ/ãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆ**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å´ä½œæ¥­ï¼‰
3. **Phase 1ã‹ã‚‰é †æ¬¡å®Ÿè£…é–‹å§‹**

---

*ã“ã®è¨­è¨ˆæ›¸ã¯å®Ÿè£…ã®é€²è¡Œã«å¿œã˜ã¦æ›´æ–°ã•ã‚Œã¾ã™ã€‚*
